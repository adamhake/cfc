# Dark Mode Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Implement system-aware dark mode with manual toggle, integrated with TanStack Router

**Architecture:** Extend existing router context with theme state, use blocking script for SSR-safe initialization, provide useTheme hook for components, add dark: variants throughout UI

**Tech Stack:** TanStack Router, React 19, TypeScript, Tailwind CSS v4, Framer Motion, lucide-react icons

---

## Task 1: Theme Utilities & Types

**Files:**
- Create: `src/utils/theme.ts`

**Step 1: Create theme utility file with types and helpers**

Create `src/utils/theme.ts`:

```typescript
/**
 * Theme utilities for dark mode support
 */

export type ThemeMode = 'light' | 'dark' | 'system';
export type ResolvedTheme = 'light' | 'dark';

const THEME_STORAGE_KEY = 'theme';

/**
 * Validates a theme value from storage
 */
export function validateTheme(value: string | null): ThemeMode {
  if (value === 'light' || value === 'dark' || value === 'system') {
    return value;
  }
  return 'system';
}

/**
 * Gets the current system preference
 */
export function getSystemPreference(): ResolvedTheme {
  if (typeof window === 'undefined') {
    return 'light';
  }
  return window.matchMedia('(prefers-color-scheme: dark)').matches
    ? 'dark'
    : 'light';
}

/**
 * Resolves theme mode to actual theme
 */
export function resolveTheme(mode: ThemeMode): ResolvedTheme {
  if (mode === 'system') {
    return getSystemPreference();
  }
  return mode;
}

/**
 * Safely gets theme from localStorage
 */
export function getStoredTheme(): ThemeMode {
  if (typeof window === 'undefined') {
    return 'system';
  }

  try {
    const stored = localStorage.getItem(THEME_STORAGE_KEY);
    return validateTheme(stored);
  } catch (e) {
    console.warn('Failed to read theme from localStorage', e);
    return 'system';
  }
}

/**
 * Safely stores theme to localStorage
 */
export function storeTheme(theme: ThemeMode): void {
  if (typeof window === 'undefined') {
    return;
  }

  try {
    localStorage.setItem(THEME_STORAGE_KEY, theme);
  } catch (e) {
    console.warn('Failed to store theme to localStorage', e);
  }
}

/**
 * Applies theme to document
 */
export function applyTheme(theme: ResolvedTheme): void {
  if (typeof document === 'undefined') {
    return;
  }

  if (theme === 'dark') {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
}
```

**Step 2: Commit theme utilities**

```bash
git add src/utils/theme.ts
git commit -m "feat: add theme utility functions and types"
```

---

## Task 2: Extend Router Context Interface

**Files:**
- Modify: `src/routes/__root.tsx:12-14`

**Step 1: Import theme types**

Add to imports at top of `src/routes/__root.tsx` (after line 10):

```typescript
import type { ThemeMode, ResolvedTheme } from "@/utils/theme";
```

**Step 2: Extend MyRouterContext interface**

Modify the `MyRouterContext` interface (lines 12-14):

```typescript
interface MyRouterContext {
  queryClient: QueryClient;
  theme: ThemeMode;
  setTheme: (theme: ThemeMode) => void;
  resolvedTheme: ResolvedTheme;
}
```

**Step 3: Commit context interface update**

```bash
git add src/routes/__root.tsx
git commit -m "feat: extend router context with theme state"
```

---

## Task 3: Add Theme Initialization Script to Head

**Files:**
- Modify: `src/routes/__root.tsx:124-129`

**Step 1: Add blocking script after HeadContent**

In the `RootDocument` component, add script right after `<HeadContent />` (after line 125):

```typescript
<HeadContent />
<script
  dangerouslySetInnerHTML={{
    __html: `
      (function() {
        try {
          const stored = localStorage.getItem('theme');
          const preference = stored || 'system';
          const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const shouldBeDark = preference === 'dark' || (preference === 'system' && systemDark);
          if (shouldBeDark) {
            document.documentElement.classList.add('dark');
          }
        } catch (e) {
          // Ignore localStorage errors
        }
      })();
    `,
  }}
/>
```

**Step 2: Commit blocking script**

```bash
git add src/routes/__root.tsx
git commit -m "feat: add blocking script to prevent theme flash"
```

---

## Task 4: Initialize Theme in Router Context

**Files:**
- Modify: `src/router.tsx`
- Read for context: `src/routes/__root.tsx` (to understand router integration pattern)

**Step 1: Import theme utilities in router.tsx**

Add to imports at top of `src/router.tsx`:

```typescript
import {
  type ThemeMode,
  type ResolvedTheme,
  getStoredTheme,
  resolveTheme,
  storeTheme,
  applyTheme,
  getSystemPreference,
} from "@/utils/theme";
```

**Step 2: Add theme state to getContext function**

Find the `getContext` function in `src/router.tsx`. It currently creates the QueryClient. We need to add theme state management. Modify it to:

```typescript
function getContext() {
  // Existing QueryClient setup
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 1000 * 60 * 5,
      },
    },
  });

  // Theme state management
  let currentTheme: ThemeMode = getStoredTheme();
  let currentResolved: ResolvedTheme = resolveTheme(currentTheme);

  const setTheme = (newTheme: ThemeMode) => {
    currentTheme = newTheme;
    currentResolved = resolveTheme(newTheme);
    storeTheme(newTheme);
    applyTheme(currentResolved);
  };

  return {
    queryClient,
    theme: currentTheme,
    setTheme,
    resolvedTheme: currentResolved,
  };
}
```

**Note:** The exact structure of `getContext` may vary. The key is to:
1. Initialize `currentTheme` from `getStoredTheme()`
2. Calculate `currentResolved` using `resolveTheme()`
3. Create `setTheme` function that updates both, stores to localStorage, and applies to DOM
4. Return all four properties in the context object

**Step 3: Commit router context initialization**

```bash
git add src/router.tsx
git commit -m "feat: initialize theme state in router context"
```

---

## Task 5: Create useTheme Hook

**Files:**
- Create: `src/hooks/useTheme.ts`

**Step 1: Create useTheme hook file**

Create `src/hooks/useTheme.ts`:

```typescript
import { useRouter } from "@tanstack/react-router";
import { useEffect, useState } from "react";
import {
  type ThemeMode,
  type ResolvedTheme,
  getSystemPreference,
  resolveTheme,
  applyTheme,
} from "@/utils/theme";

export interface UseThemeReturn {
  theme: ThemeMode;
  setTheme: (theme: ThemeMode) => void;
  resolvedTheme: ResolvedTheme;
  systemPreference: ResolvedTheme;
}

/**
 * Hook to access and control theme state
 * Integrates with TanStack Router context
 */
export function useTheme(): UseThemeReturn {
  const router = useRouter();
  const context = router.options.context;

  const [systemPreference, setSystemPreference] = useState<ResolvedTheme>(
    getSystemPreference()
  );

  // Listen to system preference changes
  useEffect(() => {
    if (typeof window === 'undefined') return;

    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

    const handleChange = (e: MediaQueryListEvent) => {
      const newPreference = e.matches ? 'dark' : 'light';
      setSystemPreference(newPreference);

      // If user has system preference enabled, update resolved theme
      if (context.theme === 'system') {
        applyTheme(newPreference);
      }
    };

    mediaQuery.addEventListener('change', handleChange);
    return () => mediaQuery.removeEventListener('change', handleChange);
  }, [context.theme]);

  // Listen to storage events for multi-tab sync
  useEffect(() => {
    if (typeof window === 'undefined') return;

    const handleStorage = (e: StorageEvent) => {
      if (e.key === 'theme' && e.newValue) {
        const newTheme = e.newValue as ThemeMode;
        const newResolved = resolveTheme(newTheme);
        context.setTheme(newTheme);
        applyTheme(newResolved);
      }
    };

    window.addEventListener('storage', handleStorage);
    return () => window.removeEventListener('storage', handleStorage);
  }, [context]);

  return {
    theme: context.theme,
    setTheme: context.setTheme,
    resolvedTheme: context.resolvedTheme,
    systemPreference,
  };
}
```

**Step 2: Commit useTheme hook**

```bash
git add src/hooks/useTheme.ts
git commit -m "feat: add useTheme hook with system preference tracking"
```

---

## Task 6: Create ThemeToggle Component

**Files:**
- Create: `src/components/ThemeToggle/theme-toggle.tsx`

**Step 1: Create ThemeToggle component file**

Create `src/components/ThemeToggle/theme-toggle.tsx`:

```typescript
import { useTheme } from "@/hooks/useTheme";
import { Moon, Sun, Monitor } from "lucide-react";
import { motion } from "framer-motion";

export interface ThemeToggleProps {
  /**
   * Visual variant of the toggle
   */
  variant?: "button" | "nav-item";
  /**
   * Whether to show text label alongside icon
   */
  showLabel?: boolean;
  /**
   * Additional CSS classes
   */
  className?: string;
}

/**
 * Theme toggle component that cycles through light, dark, and system modes
 */
export function ThemeToggle({
  variant = "button",
  showLabel = true,
  className = "",
}: ThemeToggleProps) {
  const { theme, setTheme } = useTheme();

  const handleToggle = () => {
    const nextTheme = theme === "light" ? "dark" : theme === "dark" ? "system" : "light";
    setTheme(nextTheme);
  };

  const getIcon = () => {
    switch (theme) {
      case "light":
        return <Sun className="h-5 w-5" />;
      case "dark":
        return <Moon className="h-5 w-5" />;
      case "system":
        return <Monitor className="h-5 w-5" />;
    }
  };

  const getLabel = () => {
    switch (theme) {
      case "light":
        return "Light";
      case "dark":
        return "Dark";
      case "system":
        return "System";
    }
  };

  const getAriaLabel = () => {
    return `Current theme: ${getLabel()}. Click to cycle to next theme.`;
  };

  if (variant === "nav-item") {
    return (
      <button
        onClick={handleToggle}
        type="button"
        className={`flex items-center gap-2 font-body font-medium text-grey-800 transition hover:border-b-2 hover:border-b-green-700 dark:text-grey-100 dark:hover:border-b-green-500 ${className}`}
        aria-label={getAriaLabel()}
      >
        <motion.span
          key={theme}
          initial={{ rotate: -90, opacity: 0 }}
          animate={{ rotate: 0, opacity: 1 }}
          transition={{ duration: 0.2 }}
        >
          {getIcon()}
        </motion.span>
        {showLabel && <span>Theme: {getLabel()}</span>}
      </button>
    );
  }

  return (
    <button
      onClick={handleToggle}
      type="button"
      className={`flex items-center gap-2 rounded-xl border border-grey-200 bg-grey-100/75 px-4 py-2 font-body text-sm font-semibold text-grey-800 uppercase backdrop-blur backdrop-filter transition hover:border-grey-300 hover:bg-grey-200 dark:border-grey-700 dark:bg-grey-800/75 dark:text-grey-100 dark:hover:border-grey-600 dark:hover:bg-grey-700 ${className}`}
      aria-label={getAriaLabel()}
    >
      <motion.span
        key={theme}
        initial={{ rotate: -90, opacity: 0 }}
        animate={{ rotate: 0, opacity: 1 }}
        transition={{ duration: 0.2 }}
      >
        {getIcon()}
      </motion.span>
      {showLabel && <span>{getLabel()}</span>}
    </button>
  );
}
```

**Step 2: Commit ThemeToggle component**

```bash
git add src/components/ThemeToggle/theme-toggle.tsx
git commit -m "feat: add ThemeToggle component with three-state cycling"
```

---

## Task 7: Create ThemeToggle Storybook Stories

**Files:**
- Create: `src/components/ThemeToggle/theme-toggle.stories.ts`

**Step 1: Create Storybook stories file**

Create `src/components/ThemeToggle/theme-toggle.stories.ts`:

```typescript
import type { Meta, StoryObj } from "@storybook/react";
import { ThemeToggle } from "./theme-toggle";

const meta = {
  title: "Components/ThemeToggle",
  component: ThemeToggle,
  parameters: {
    layout: "centered",
  },
  tags: ["autodocs"],
  argTypes: {
    variant: {
      control: "select",
      options: ["button", "nav-item"],
      description: "Visual variant of the toggle",
    },
    showLabel: {
      control: "boolean",
      description: "Whether to show text label",
    },
  },
} satisfies Meta<typeof ThemeToggle>;

export default meta;
type Story = StoryObj<typeof meta>;

export const Button: Story = {
  args: {
    variant: "button",
    showLabel: true,
  },
};

export const ButtonWithoutLabel: Story = {
  args: {
    variant: "button",
    showLabel: false,
  },
};

export const NavItem: Story = {
  args: {
    variant: "nav-item",
    showLabel: true,
  },
};

export const NavItemWithoutLabel: Story = {
  args: {
    variant: "nav-item",
    showLabel: false,
  },
};
```

**Step 2: Test in Storybook (optional verification)**

Run: `npm run storybook`
Open: http://localhost:6006
Navigate: Components → ThemeToggle
Expected: Four stories render correctly, toggle cycles through states

**Step 3: Commit Storybook stories**

```bash
git add src/components/ThemeToggle/theme-toggle.stories.ts
git commit -m "feat: add Storybook stories for ThemeToggle"
```

---

## Task 8: Add ThemeToggle to Desktop Dropdown Menu

**Files:**
- Modify: `src/components/Header/header.tsx:1-7` (imports)
- Modify: `src/components/Header/header.tsx:107-166` (desktop menu)

**Step 1: Import ThemeToggle component**

Add to imports at top of `src/components/Header/header.tsx` (after line 7):

```typescript
import { ThemeToggle } from "../ThemeToggle/theme-toggle";
```

**Step 2: Add ThemeToggle to desktop dropdown menu navigation**

In the desktop dropdown menu (lines 107-166), find the navigation `<ul>` element (around lines 109-142). Add ThemeToggle as a new list item after the last navigation link:

```typescript
<nav>
  <ul className="space-y-2">
    <li>
      <Link
        to="/"
        className="font-body font-medium text-grey-800 transition hover:border-b-2 hover:border-b-green-700"
      >
        Home
      </Link>
    </li>
    <li>
      <a
        href=""
        className="font-body font-medium text-grey-800 transition hover:border-b-2 hover:border-b-green-700"
      >
        About
      </a>
    </li>
    <li>
      <a
        href=""
        className="font-body font-medium text-grey-800 transition hover:border-b-2 hover:border-b-green-700"
      >
        Events
      </a>
    </li>
    <li>
      <a
        href=""
        className="font-body font-medium text-grey-800 transition hover:border-b-2 hover:border-b-green-700"
      >
        Get Involved
      </a>
    </li>
    <li className="pt-2">
      <ThemeToggle variant="nav-item" showLabel={true} />
    </li>
  </ul>
</nav>
```

**Step 3: Commit desktop menu integration**

```bash
git add src/components/Header/header.tsx
git commit -m "feat: add ThemeToggle to desktop dropdown menu"
```

---

## Task 9: Add ThemeToggle to Mobile Full-Screen Menu

**Files:**
- Modify: `src/components/Header/header.tsx:213-261` (mobile menu navigation)

**Step 1: Add ThemeToggle to mobile menu navigation**

In the mobile full-screen menu navigation (lines 213-261), find the `<ul>` element (around lines 214-260). Add ThemeToggle as a new list item after the last navigation link:

```typescript
<nav className="flex-1">
  <ul className="space-y-6">
    <li>
      <Link
        to="/"
        onClick={() => setMenuOpen(false)}
        className="block font-display text-3xl text-grey-800 transition hover:text-green-700"
      >
        Home
      </Link>
    </li>
    <li>
      <a
        href=""
        onClick={() => setMenuOpen(false)}
        className="block font-display text-3xl text-grey-800 transition hover:text-green-700"
      >
        About
      </a>
    </li>
    <li>
      <a
        href=""
        onClick={() => setMenuOpen(false)}
        className="block font-display text-3xl text-grey-800 transition hover:text-green-700"
      >
        Events
      </a>
    </li>
    <li>
      <a
        href=""
        onClick={() => setMenuOpen(false)}
        className="block font-display text-3xl text-grey-800 transition hover:text-green-700"
      >
        Get Involved
      </a>
    </li>
    <li>
      <Link
        to="/media"
        onClick={() => setMenuOpen(false)}
        className="block font-display text-3xl text-grey-800 transition hover:text-green-700"
      >
        Media
      </Link>
    </li>
    <li className="pt-4">
      <ThemeToggle variant="button" showLabel={true} />
    </li>
  </ul>
</nav>
```

**Step 2: Commit mobile menu integration**

```bash
git add src/components/Header/header.tsx
git commit -m "feat: add ThemeToggle to mobile full-screen menu"
```

---

## Task 10: Add Dark Mode Variants to Header Component

**Files:**
- Modify: `src/components/Header/header.tsx` (multiple lines for dark: classes)

**Step 1: Add dark variants to header container**

Line 47 - Update header className:

```typescript
className="w-full max-w-6xl rounded-2xl transition md:border md:border-grey-100 md:bg-grey-100/75 md:backdrop-blur md:backdrop-filter dark:md:border-grey-700 dark:md:bg-grey-800/75"
```

**Step 2: Add dark variants to desktop menu button**

Line 56 - Update desktop menu button className:

```typescript
className="hidden w-28 cursor-pointer items-center gap-2 rounded-xl border border-green-800 px-4 py-2 font-body text-sm font-semibold text-green-800 uppercase transition hover:border-green-700 hover:bg-green-700 hover:text-grey-100 dark:border-green-600 dark:text-green-400 dark:hover:border-green-500 dark:hover:bg-green-600 dark:hover:text-grey-100 md:flex"
```

**Step 3: Add dark variants to mobile logo button**

Line 65 - Update mobile logo button className:

```typescript
className="flex h-12 w-12 items-center justify-center rounded-full border border-grey-100 bg-grey-50/75 text-green-800 backdrop-blur backdrop-filter dark:border-grey-700 dark:bg-grey-800/75 dark:text-green-400 md:hidden"
```

**Step 4: Add dark variants to center branding**

Line 71 - Update center branding className:

```typescript
className="hidden items-center gap-2 text-green-800 dark:text-green-400 md:flex"
```

**Step 5: Add dark variants to donate/menu button**

Line 89 - Update donate/menu button className:

```typescript
className="cursor-pointer rounded-xl border border-grey-200 bg-grey-100/75 px-4 py-2 text-center font-body text-sm font-semibold text-green-800 uppercase backdrop-blur backdrop-filter transition dark:border-grey-700 dark:bg-grey-800/75 dark:text-green-400 md:w-28 md:border-green-800 md:bg-green-700 md:text-white md:hover:border-green-700 md:hover:bg-green-700 md:hover:text-grey-100 dark:md:border-green-600 dark:md:bg-green-600 dark:md:hover:border-green-500 dark:md:hover:bg-green-500"
```

**Step 6: Add dark variants to dropdown menu content**

Line 107 - Update dropdown menu content className:

```typescript
className="mt-4 flex w-full justify-between border-t border-grey-300 p-6 pt-8 transition dark:border-grey-700"
```

**Step 7: Add dark variants to nav links**

Lines 113, 121, 129, 137 - Update each nav link className:

```typescript
className="font-body font-medium text-grey-800 transition hover:border-b-2 hover:border-b-green-700 dark:text-grey-100 dark:hover:border-b-green-500"
```

**Step 8: Add dark variants to event card section**

Line 158 - Update event card title className:

```typescript
className="mb-2 font-display text-lg text-grey-800 dark:text-grey-100"
```

**Step 9: Add dark variants to mobile menu**

Line 180 - Update mobile menu background className:

```typescript
className="fixed inset-0 z-50 bg-grey-50 dark:bg-grey-900 md:hidden"
```

**Step 10: Add dark variants to mobile close button**

Line 205 - Update mobile close button className:

```typescript
className="flex h-12 w-12 items-center justify-center rounded-full border border-grey-200 bg-white text-grey-800 transition hover:bg-grey-100 dark:border-grey-700 dark:bg-grey-800 dark:text-grey-100 dark:hover:bg-grey-700"
```

**Step 11: Add dark variants to mobile nav links**

Lines 219, 228, 237, 246, 255 - Update each mobile nav link className:

```typescript
className="block font-display text-3xl text-grey-800 transition hover:text-green-700 dark:text-grey-100 dark:hover:text-green-400"
```

**Step 12: Add dark variants to mobile donate button**

Line 267 - Update mobile donate button className:

```typescript
className="w-full cursor-pointer rounded-xl border border-green-800 bg-green-700 px-6 py-4 text-center font-body text-base font-semibold text-white uppercase transition active:bg-green-800 dark:border-green-600 dark:bg-green-600 dark:active:bg-green-500"
```

**Step 13: Add dark variants to mobile footer text**

Line 271 - Update mobile footer text className:

```typescript
className="text-center font-body text-sm text-grey-600 dark:text-grey-400"
```

**Step 14: Commit header dark mode variants**

```bash
git add src/components/Header/header.tsx
git commit -m "feat: add dark mode variants to Header component"
```

---

## Task 11: Add Dark Mode Variants to Button Component

**Files:**
- Modify: `src/components/Button/button.tsx`
- Read for context: `src/components/Button/button.tsx` (to understand existing variants)

**Step 1: Read Button component to understand structure**

Read `src/components/Button/button.tsx` to see the existing className logic and variants.

**Step 2: Add dark variants to button base classes and variants**

You'll need to add `dark:` prefixed classes to each variant. Based on typical button implementations:

For **primary variant** (if it exists), add:
- `dark:bg-green-600 dark:hover:bg-green-500 dark:text-grey-100`

For **outline variant** (if it exists), add:
- `dark:border-green-500 dark:text-green-400 dark:hover:bg-green-900 dark:hover:border-green-400`

For **ghost variant** (if it exists), add:
- `dark:text-grey-100 dark:hover:bg-grey-800`

**Note:** The exact classes will depend on the current implementation. The pattern is:
- Dark backgrounds use darker greys (grey-800, grey-900)
- Dark text uses lighter greys (grey-100, grey-200)
- Green accents shift to lighter greens (green-400, green-500, green-600)

**Step 3: Commit button dark mode variants**

```bash
git add src/components/Button/button.tsx
git commit -m "feat: add dark mode variants to Button component"
```

---

## Task 12: Add Dark Mode Variants to Footer Component

**Files:**
- Modify: `src/components/Footer/footer.tsx`

**Step 1: Read Footer component to understand structure**

Read `src/components/Footer/footer.tsx` to see the current implementation.

**Step 2: Add dark variants to footer**

Add `dark:` classes following this pattern:

**Footer container:**
- `dark:bg-grey-900` (for background)
- `dark:border-grey-800` (for any borders)

**Text elements:**
- `dark:text-grey-100` (for primary text)
- `dark:text-grey-300` (for secondary text)
- `dark:text-grey-400` (for muted text)

**Links:**
- `dark:text-green-400` (for link color)
- `dark:hover:text-green-300` (for link hover)

**Step 3: Commit footer dark mode variants**

```bash
git add src/components/Footer/footer.tsx
git commit -m "feat: add dark mode variants to Footer component"
```

---

## Task 13: Add Dark Mode Variants to Hero Component

**Files:**
- Modify: `src/components/Hero/hero.tsx`

**Step 1: Read Hero component to understand structure**

Read `src/components/Hero/hero.tsx` to see the current implementation, especially image overlays and text.

**Step 2: Add dark variants to hero**

Focus on text readability over images:

**Heading text:**
- `dark:text-grey-50` (for maximum contrast)

**Body text:**
- `dark:text-grey-100`

**Background overlays (if any):**
- Adjust opacity for better image visibility in dark mode
- Example: `dark:bg-grey-900/60` (instead of grey-50/60)

**Buttons/CTAs:**
- Use Button component (already has dark variants from Task 11)

**Step 3: Commit hero dark mode variants**

```bash
git add src/components/Hero/hero.tsx
git commit -m "feat: add dark mode variants to Hero component"
```

---

## Task 14: Add Dark Mode Variants to Event Component

**Files:**
- Modify: `src/components/Event/event.tsx`

**Step 1: Read Event component to understand structure**

Read `src/components/Event/event.tsx` to see the current card/item implementation.

**Step 2: Add dark variants to event cards**

**Card container:**
- `dark:bg-grey-800` (for card background)
- `dark:border-grey-700` (for card borders)

**Title/heading:**
- `dark:text-grey-100`

**Date/metadata:**
- `dark:text-grey-300`

**Description text:**
- `dark:text-grey-200`

**Hover states:**
- `dark:hover:bg-grey-750` (if hover effect exists)
- `dark:hover:border-grey-600`

**Step 3: Commit event component dark mode variants**

```bash
git add src/components/Event/event.tsx
git commit -m "feat: add dark mode variants to Event component"
```

---

## Task 15: Add Dark Mode Variants to Remaining Components

**Files:**
- Modify: `src/components/Vision/vision.tsx` (if exists)
- Modify: `src/components/Quote/quote.tsx` (if exists)
- Modify: Any other component files with visual elements

**Step 1: Identify remaining components**

Run: `ls -la src/components/*/`
Review: Find components not yet updated with dark mode

**Step 2: Add dark variants to each component**

Follow the same pattern as previous tasks:
- Backgrounds: grey-50/100 → grey-900/800
- Text: grey-800/900 → grey-100/50
- Borders: grey-200/300 → grey-700/600
- Greens: green-700/800 → green-400/500/600

**Step 3: Commit each component separately**

For each component:
```bash
git add src/components/[ComponentName]/[component-name].tsx
git commit -m "feat: add dark mode variants to [ComponentName] component"
```

---

## Task 16: Test Dark Mode Functionality

**Files:**
- None (manual testing)

**Step 1: Start development server**

Run: `npm run start`
Expected: Server starts on http://localhost:3000

**Step 2: Test basic toggle functionality**

1. Open http://localhost:3000
2. Open desktop menu (click "Menu" button)
3. Click theme toggle
4. Expected: Theme cycles through light → dark → system
5. Expected: Visual changes apply immediately
6. Expected: No page flash or layout shift

**Step 3: Test persistence**

1. Set theme to "dark"
2. Navigate to different page (if available)
3. Expected: Theme remains "dark"
4. Hard refresh page (Cmd+Shift+R / Ctrl+Shift+R)
5. Expected: Theme still "dark", no flash of light mode

**Step 4: Test system preference**

1. Set theme to "system"
2. Change OS theme (System Settings → Appearance)
3. Expected: Site theme updates immediately

**Step 5: Test mobile menu**

1. Resize browser to mobile width (< 768px)
2. Open mobile menu
3. Expected: Theme toggle visible and functional
4. Click toggle
5. Expected: Same behavior as desktop

**Step 6: Test localStorage**

1. Open DevTools Console
2. Run: `localStorage.getItem('theme')`
3. Expected: Returns current theme ('light', 'dark', or 'system')
4. Toggle theme
5. Run command again
6. Expected: Updated value

**Step 7: Test multi-tab sync**

1. Open site in two browser tabs
2. Toggle theme in tab 1
3. Expected: Tab 2 updates automatically

**Step 8: Create testing checklist**

Create a file documenting test results: `docs/testing/dark-mode-manual-tests.md`

```markdown
# Dark Mode Manual Testing Checklist

**Date:** [Today's date]
**Tested by:** [Your name]

## Basic Functionality
- [ ] Toggle works in desktop dropdown menu
- [ ] Toggle works in mobile menu
- [ ] Toggle cycles through all three states
- [ ] Current theme visually indicated

## Persistence
- [ ] Preference persists across page navigation
- [ ] Preference persists after browser close/reopen
- [ ] localStorage stores correct value

## System Preference
- [ ] 'system' mode auto-applies OS theme
- [ ] OS theme change updates site immediately
- [ ] Manual mode ignores OS changes

## SSR & Performance
- [ ] No theme flash on initial load
- [ ] No theme flash on hard refresh
- [ ] No layout shift

## Edge Cases
- [ ] Multiple tabs sync changes
- [ ] First visit defaults to 'system'
- [ ] Private browsing mode works

## Visual Quality
- [ ] All text readable in both themes
- [ ] Sufficient contrast everywhere
- [ ] Images/overlays look good
- [ ] Hover states visible
- [ ] Focus indicators visible

## Accessibility
- [ ] Toggle keyboard accessible
- [ ] Screen reader announces theme
- [ ] Color not only indicator
```

**Step 9: Document any issues found**

If issues found during testing, document them in the checklist and prepare for fixes.

---

## Task 17: Fix Any Issues Found in Testing

**Files:**
- Depends on issues found

**Step 1: Prioritize issues**

Review testing checklist and categorize:
1. Critical: Broken functionality, flash of wrong theme
2. High: Poor contrast, accessibility issues
3. Medium: Visual polish, edge cases
4. Low: Nice-to-haves

**Step 2: Fix critical and high priority issues**

For each issue:
1. Identify root cause
2. Implement fix
3. Test fix
4. Commit with descriptive message

Example commit:
```bash
git add [affected-files]
git commit -m "fix: improve contrast on dark mode event cards"
```

**Step 3: Re-test after fixes**

Run through testing checklist again to verify fixes.

---

## Task 18: Update Documentation

**Files:**
- Create: `docs/features/dark-mode.md` (user-facing documentation)

**Step 1: Create user-facing documentation**

Create `docs/features/dark-mode.md`:

```markdown
# Dark Mode

The Chimborazo Park Conservancy website supports dark mode to reduce eye strain and respect user preferences.

## How It Works

The site offers three theme modes:

- **Light**: Forces light theme regardless of system preference
- **Dark**: Forces dark theme regardless of system preference
- **System**: Automatically matches your operating system's theme preference (default)

## Changing Theme

1. Click the **Menu** button in the header
2. Look for the theme toggle (shows sun, moon, or monitor icon)
3. Click to cycle through: Light → Dark → System

Your preference is saved and will persist across visits.

## System Preference

If you select "System" mode (monitor icon), the site will automatically:
- Match your OS theme when you first visit
- Update immediately when you change your OS theme
- Sync across multiple tabs/windows

## Browser Support

Dark mode works in all modern browsers that support:
- CSS custom properties
- localStorage
- `prefers-color-scheme` media query

## Accessibility

The dark theme maintains WCAG AA contrast ratios for readability. All interactive elements remain clearly visible in both themes.
```

**Step 2: Commit documentation**

```bash
git add docs/features/dark-mode.md
git commit -m "docs: add user-facing dark mode documentation"
```

---

## Task 19: Prepare Pull Request

**Files:**
- None (git operations)

**Step 1: Review all changes**

Run: `git log --oneline main..HEAD`
Expected: List of all commits from this feature

Run: `git diff main...HEAD --stat`
Expected: Summary of all file changes

**Step 2: Ensure all changes committed**

Run: `git status`
Expected: "nothing to commit, working tree clean"

**Step 3: Push branch to remote**

Run: `git push -u origin feature/dark-mode`
Expected: Branch pushed successfully

**Step 4: Create pull request**

If using `gh` CLI:
```bash
gh pr create --title "feat: implement dark mode with system preference support" --body "$(cat <<'EOF'
## Summary

Implements dark mode support with:
- System preference detection with manual override
- localStorage persistence
- SSR-safe initialization (no theme flash)
- Theme toggle in header menus (desktop & mobile)
- Dark variants for all components
- TanStack Router integration

## Implementation

- **Theme utilities**: Type-safe helpers for theme management
- **Router context**: Extended with theme state
- **useTheme hook**: React hook for theme access and control
- **ThemeToggle component**: Three-state toggle (light/dark/system)
- **Dark variants**: Added to all components with good contrast
- **Blocking script**: Prevents flash of incorrect theme on load

## Testing

- [x] Toggle works in desktop & mobile menus
- [x] Persistence across sessions
- [x] System preference tracking
- [x] Multi-tab synchronization
- [x] No theme flash on load
- [x] WCAG AA contrast ratios maintained

## Design Document

See: `docs/plans/2025-10-22-dark-mode-design.md`

## Screenshots

[TODO: Add screenshots of light and dark modes]
EOF
)"
```

Or open GitHub web interface and create PR manually with same title/body.

**Step 5: Add labels and reviewers**

Add appropriate labels: `enhancement`, `frontend`, `ui`
Request review from team members

---

## Completion Checklist

Before marking this plan complete, verify:

- [ ] All 19 tasks completed
- [ ] All commits have descriptive messages
- [ ] No console errors in browser
- [ ] Manual testing checklist completed
- [ ] Documentation written
- [ ] Pull request created
- [ ] No merge conflicts with main
- [ ] Ready for code review

## Notes for Reviewer

**Key areas to review:**

1. **SSR Safety**: Verify blocking script works and prevents theme flash
2. **Accessibility**: Check contrast ratios and keyboard navigation
3. **Code Quality**: Review TypeScript types and error handling
4. **User Experience**: Test toggle in both desktop and mobile menus
5. **Edge Cases**: Test in private browsing, multiple tabs, system changes

**Files with most changes:**
- `src/components/Header/header.tsx` - Theme toggle integration + dark variants
- `src/hooks/useTheme.ts` - Core theme logic
- `src/routes/__root.tsx` - Context extension + blocking script
- `src/router.tsx` - Theme state initialization

**Technical decisions documented in:** `docs/plans/2025-10-22-dark-mode-design.md`
